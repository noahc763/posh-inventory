<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Barcode Labels</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      /* Defaults; can be overridden by preset */
      --label-w: 2.625in;  /* Avery 5160 width */
      --label-h: 1.0in;    /* Avery 5160 height */
      --gap:     0.125in;
      --margin:  0.5in;
      --cols:    {{ cols }};
    }
    {% if preset %}
    :root{
      --label-w: {{ preset.label_w }};
      --label-h: {{ preset.label_h }};
      --gap:     {{ preset.gap }};
      --margin:  {{ preset.margin }};
    }
    {% endif %}

    /* Screen helpers */
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; }
    .toolbar{
      display: flex; gap: 8px; align-items: center; padding: 10px;
      position: sticky; top: 0; background: #fff; border-bottom: 1px solid #eee; z-index: 1;
    }
    .toolbar .btn { padding: 8px 12px; border: 1px solid #ccc; border-radius: 8px; background: #f7f7f7; cursor: pointer; }
    .info { color: #666; font-size: 0.9rem; }

    .sheet {
      margin: 12px auto;
      width: calc((var(--label-w) * var(--cols)) + (var(--gap) * (var(--cols) - 1)) + (var(--margin) * 2));
      padding: var(--margin);
      box-sizing: content-box;
      background: #fff;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(var(--cols), var(--label-w));
      grid-auto-rows: var(--label-h);
      gap: var(--gap);
    }

    .label {
      box-sizing: border-box;
      padding: 4px 6px;
      overflow: hidden;
      border: 1px dashed #ddd; /* visible on screen only */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      page-break-inside: avoid;
    }
    .title {
      font-size: 10pt;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      width: 100%;
    }
    .imgwrap {
      display:flex; align-items:center; justify-content:center;
      width: 100%;
    }
    .imgwrap img {
      max-width: 100%;
      max-height: calc(var(--label-h) - 18px);
      display:block;
    }

    /* Print rules */
    @media print {
      @page { size: auto; margin: 0; }
      body { margin: 0; }
      .toolbar { display: none; }
      .label { border: none; }
      .sheet { margin: 0 auto; }
    }
  </style>
</head>
<body>

<div class="toolbar">
  <button class="btn" onclick="window.print()">üñ®Ô∏è Print</button>
  <div class="info">
    Columns: {{ cols }}{% if preset %} ¬∑ Preset: yes ({{ preset.label_w }} √ó {{ preset.label_h }}){% endif %}
  </div>
</div>

<div class="sheet">
  <div class="grid">
    {% for lab in labels %}
      <div class="label">
        <div class="title">{{ lab.title }}</div>
        <div class="imgwrap">
          <img src="{{ lab.img }}" alt="QR">
        </div>
        {% if lab.text %}
          <div class="title" style="font-size:9pt; color:#333;">{{ lab.text }}</div>
        {% endif %}
         
    {% endfor %}
  </div>
</div>

</body>
</html>
