<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Barcode Labels</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --label-w: {{ label_w|default('40mm') }};
      --label-h: {{ label_h|default('30mm') }};
      --gap:     {{ gap|default('0mm') }};
      --margin:  {{ margin|default('0mm') }};
      --cols:    {{ cols|default(1) }};
    }
  
    .grid {
      display:grid;
      grid-template-columns: repeat(var(--cols), var(--label-w));
      grid-auto-rows: var(--label-h);
      gap: var(--gap);
    }
  
    .label {
      width: var(--label-w);
      height: var(--label-h);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:0;
      margin:0;
      overflow:hidden;
      page-break-inside:avoid;
    }
  
    .price {
      font-size: 10pt;
      font-weight: bold;
      margin-bottom: 1mm;
      white-space: nowrap;
    }
  
    .imgwrap {
      flex:1;
      width:100%;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
    }
  
    .imgwrap img {
      width: 100%;
      height: 100%;
      object-fit: contain; /* scale up while keeping aspect ratio */
    }
  
    @media print {
      @page { size:auto; margin:0; }
      body { margin:0; }
      .label { border:none; }
    }
  </style>
  
  <div class="sheet">
    <div class="grid">
      {% for lab in labels %}
        <div class="label">
          {% if lab.price %}
            <div class="price">{{ lab.price }}</div>
          {% endif %}
          <div class="imgwrap">
            <img src="{{ lab.img }}" alt="Barcode {{ lab.barcode }}">
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
  
  
</head>
<body>

<div class="toolbar">
  <button class="btn" onclick="window.print()">üñ®Ô∏è Print</button>
  <div class="info">
    {{ cols|default(1) }} column{{ 1 if (cols|default(1)) == 1 else 's' }},
    {{ label_w|default('40mm') }} √ó {{ label_h|default('30mm') }},
    DPI: {{ dpi|default(300) }}
  </div>
</div>

<div class="sheet">
  <div class="grid">
    {% for lab in labels %}
      <div class="label">
        {% if lab.price %}
          <div class="price">{{ lab.price }}</div>
        {% endif %}
        <div class="imgwrap">
          <img src="{{ lab.img }}" alt="Barcode {{ lab.barcode }}">
        </div>
        <div class="code">{{ lab.human }}</div>
      </div>
    {% endfor %}
  </div>
</div>

</body>
</html>
