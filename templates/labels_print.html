<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Barcode Labels</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --label-w: 40mm;   /* physical label width */
      --label-h: 30mm;   /* physical label height */
      --gap:     0mm;    /* no gaps for roll */
      --margin:  0mm;    /* no page margin */
      --cols:    {{ cols|default(1) }};
    }
  
    /* Screen helpers */
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
    }
    .toolbar{
      display:flex; gap:8px; align-items:center; padding:10px;
      position: sticky; top:0; background:#fff; border-bottom:1px solid #eee; z-index:1;
    }
    .toolbar .btn { padding:8px 12px; border:1px solid #ccc; border-radius:8px; background:#f7f7f7; cursor:pointer; }
  
    /* Canvas that holds all labels */
    .sheet{
      margin: 12px auto;
      width: calc((var(--label-w) * var(--cols)) + (var(--gap) * (var(--cols) - 1)) + (var(--margin) * 2));
      padding: var(--margin);
      box-sizing: content-box;
      background:#fff;
    }
  
    .grid{
      display:grid;
      grid-template-columns: repeat(var(--cols), var(--label-w));
      grid-auto-rows: var(--label-h);
      gap: var(--gap);
    }
  
    /* The label itself should be exactly 40x30mm with no extra padding in print */
    .label{
      width: var(--label-w);
      height: var(--label-h);
      box-sizing: border-box;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap: 2mm;           /* spacing between image and digits */
      padding: 0mm;       /* IMPORTANT: no padding in print */
      border: 1px dashed #ddd; /* screen-only visual aid */
    }
  
    .imgwrap{
      width: 100%;
      height: calc(var(--label-h) - 8mm); /* leave room for digits */
      display:flex; align-items:center; justify-content:center;
    }
    .imgwrap img{
      width: 100%;
      height: 100%;
      object-fit: contain;           /* fill area while preserving aspect */
      image-rendering: crisp-edges;  /* helps thermal printers */
    }
  
    .digits{
      font-size: 10pt;
      line-height: 1;
      letter-spacing: 0.06em;
      white-space: nowrap;
    }
  
    /* Print rules: force the physical paper size and disable margins/scaling */
    @media print {
      @page {
        size: var(--label-w) var(--label-h);
        margin: 0;
      }
      html, body {
        width: var(--label-w);
        height: var(--label-h);
        margin: 0 !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      .toolbar{ display:none; }
      .sheet{ margin: 0 auto; padding: 0; }
      .label{ border: none; }  /* remove the dashed border in print */
      /* If you’re printing multiple labels, most roll drivers will print one per page.
         For sheet printers (A4/Letter), set cols > 1 and adjust @page to the sheet size instead. */
    }
  </style>
  
</head>
<body>

<div class="toolbar">
  <button class="btn" onclick="window.print()">🖨️ Print</button>
  <div class="info">Columns: {{ cols }} · Size: {{ label_w }} × {{ label_h }} at {{ dpi }} DPI</div>
</div>

<div class="sheet">
  <div class="grid">
    {% for lab in labels %}
      <div class="label">
        <div class="imgwrap">
          <img src="{{ lab.img }}" alt="Barcode {{ lab.barcode }}">
        </div>
        <div class="digits">{{ lab.barcode }}</div>
      </div>
    {% endfor %}
  </div>
</div>

</body>
</html>
