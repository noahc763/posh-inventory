{% extends "base.html" %}
{% block content %}

<section class="card" style="max-width:900px;margin:0 auto;">
  <div class="card-header" style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;">
    <h2 style="margin:0;">Item Details</h2>
    <div style="display:flex;gap:8px;">
      <a class="btn" href="{{ url_for('items.edit_item', item_id=item.id) }}">Edit</a>
      <form method="post"
            action="{{ url_for('items.bulk_delete_items') }}"
            onsubmit="return confirm('Delete this item permanently?');">
        <input type="hidden" name="ids" value="{{ item.id }}">
        <button class="btn danger" type="submit">Delete</button>
      </form>
    </div>
  </div>

  <div class="card-body">
    <style>
      .kv { display:grid; grid-template-columns: 180px 1fr; gap:10px 16px; margin-bottom:16px; }
      .kv .k { color:#475569; }
      .profit-pos { color:#166534; font-weight:600; }
      .profit-neg { color:#7f1d1d; font-weight:600; }
      .detail-photo { width:220px; height:220px; border-radius:12px; overflow:hidden; background:#eef2f7; border:1px solid #d9e0ea; }
      .detail-photo img { width:100%; height:100%; object-fit:cover; image-orientation:from-image; transform:none !important; }
    </style>

    <div style="display:flex; gap:20px; align-items:flex-start; flex-wrap:wrap;">
      {% set p = (item.photo_path or '')|trim %}
      {% if p %}
        {% if p.startswith('http://') or p.startswith('https://') or p.startswith('/static/') %}
          {% set img_url = p %}
        {% else %}
          {% set img_url = url_for('static', filename=p.lstrip('/')) %}
        {% endif %}
        <div class="detail-photo">
          <img src="{{ img_url }}" alt="Photo of {{ item.title or item.name }}" onerror="this.closest('.detail-photo').style.display='none';">
        </div>
      {% endif %}

      <div style="flex:1;min-width:260px;">
        <h3 style="margin:0 0 8px 0;">{{ item.title }}</h3>

        <div class="kv">
          <div class="k">Category</div>
          <div>{{ item.category.name if item.category else "—" }}</div>

          <div class="k">Barcode</div>
          <div>{{ item.barcode or "—" }}</div>

          <div class="k">Purchase</div>
          <div>
            {% if item.purchase_price is not none %}${{ '%.2f'|format(item.purchase_price) }}{% else %}—{% endif %}
            {% if item.purchase_date %}<span class="muted small"> · {{ item.purchase_date }}</span>{% endif %}
          </div>

          <div class="k">List Price</div>
          <div>{% if item.list_price is not none %}${{ '%.2f'|format(item.list_price) }}{% else %}—{% endif %}</div>

          <div class="k">Sold</div>
          <div>
            {% if item.sold_price is not none %}${{ '%.2f'|format(item.sold_price) }}{% else %}—{% endif %}
            {% if item.sold_date %}<span class="muted small"> · {{ item.sold_date }}</span>{% endif %}
          </div>

          <div class="k">Profit</div>
          <div>
            {% if item.profit is not none %}
              {% set prof = item.profit %}
              <span class="{{ 'profit-pos' if prof >= 0 else 'profit-neg' }}">
                ${{ '%.2f'|format(prof) }}
              </span>
            {% else %}
              <span class="muted">—</span>
            {% endif %}
          </div>

          <div class="k">Purchase Source</div>
          <div>{{ item.purchase_source or "—" }}</div>

          <div class="k">Notes</div>
          <div style="white-space:pre-wrap">{{ item.notes or "—" }}</div>
        </div>

        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <a class="btn outline" href="{{ url_for('dashboard') }}">Back</a>
          {% if item.barcode %}
            <a class="btn outline" target="_blank" rel="noopener"
               href="/labels/print?ids={{ item.id }}&cols=1&dpi=203&copies=1">Print Label</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</section>

{% endblock %}
