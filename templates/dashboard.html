{% extends "base.html" %}
{% block content %}
<section class="card">
  <div class="card-header" style="display:flex;justify-content:space-between;align-items:center;">
    <h2 style="margin:0;">Your Items</h2>
    <div style="display:flex; gap:8px;">
      <form method="get" action="{{ url_for('dashboard') }}" style="display:flex; gap:8px; align-items:center;">
        <label class="field" style="flex-direction:row; align-items:center; gap:8px; margin:0;">
          <span class="muted">Category</span>
          <select name="category" onchange="this.form.submit()">
            <option value="">All</option>
            {% for c in categories %}
              <option value="{{ c.id }}" {% if selected_cat == c.id %}selected{% endif %}>{{ c.name }}</option>
            {% endfor %}
          </select>
        </label>
      </form>
      {% if categories %}
        <!-- Quick add to first category (example); you could list all categories and add buttons per-row instead -->
        <a class="btn" href="{{ url_for('items_new', category_id=categories[0].id) }}">Add Item</a>
      {% endif %}
    </div>
  </div>
  <div class="card-body">
    <table>
      <thead>
        <tr>
          <th>Title</th>
          <th>Barcode</th>
          <th>Category</th>
          <th>Purchase</th>
          <th>Sold</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for it in items %}
          <tr>
            <td>{{ it.title }}</td>
            <td>{{ it.barcode or '—' }}</td>
            <td>{{ it.category.name if it.category else '—' }}</td>
            <td>${{ '%.2f'|format(it.purchase_price or 0) }}</td>
            <td>
              {% if it.sold_price %}
                ${{ '%.2f'|format(it.sold_price) }}
              {% else %} — {% endif %}
            </td>
            <td style="text-align:right;">
              <a class="btn" href="{{ url_for('item_detail', item_id=it.id) }}">View</a>
              <a class="btn" href="{{ url_for('items.edit_item', item_id=it.id) }}">Edit</a>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="6" class="muted">No items yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
