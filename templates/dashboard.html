{% extends "base.html" %}
{% block content %}
<section class="card">
  <div class="card-header">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;">
      <h2 style="margin:0;">Your Items</h2>
      <div class="actions" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
        <a class="btn" href="{{ url_for('items_new') }}">+ Add Item</a>
        <a class="btn outline" href="{{ url_for('scan') }}">ðŸ“· Scan</a>
      </div>
    </div>
  </div>

  <div class="card-body">
    <form method="get" action="{{ url_for('dashboard') }}" style="display:flex;gap:8px;align-items:flex-end;margin-bottom:12px;flex-wrap:wrap;">
      <label class="field" style="min-width:220px;">
        <span class="muted">Filter by category</span>
        <select name="category" class="input" onchange="this.form.submit()">
          <option value="">All categories</option>
          {% for c in categories %}
            <option value="{{ c.id }}" {% if selected_cat == c.id %}selected{% endif %}>{{ c.name }}</option>
          {% endfor %}
        </select>
      </label>
      {% if selected_cat %}
        <a class="btn outline" href="{{ url_for('dashboard') }}">Clear</a>
      {% endif %}
    </form>

    <div class="table-wrap">
      <table class="table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Barcode</th>
            <th>Category</th>
            <th>Purchase</th>
            <th>Sold</th>
            <th class="right"></th>
          </tr>
        </thead>
        <tbody>
          {% for it in items %}
          <tr>
            <td>
              <a class="link" href="{{ url_for('item_detail', item_id=it.id) }}">{{ it.title }}</a>
            </td>
            <td>{{ it.barcode or "â€”" }}</td>
            <td>{{ it.category.name if it.category else "â€”" }}</td>
            <td>
              {% if it.purchase_price %}
                ${{ '%.2f'|format(it.purchase_price) }}
              {% else %}
                â€” 
              {% endif %}
            </td>
            <td>
              {% if it.sold_price %}
                ${{ '%.2f'|format(it.sold_price) }}
              {% else %}
                â€” 
              {% endif %}
            </td>
            <td class="right" style="white-space:nowrap;">
              <a class="btn outline" href="{{ url_for('item_detail', item_id=it.id) }}">View</a>
              <a class="btn outline" href="{{ url_for('items.edit_item', item_id=it.id) }}">Edit</a>
              <a class="btn outline" href="{{ url_for('labels.item_barcode_png', item_id=it.id) }}" target="_blank" rel="noopener">Barcode</a>
              <a class="btn outline" href="{{ url_for('labels.labels_print') }}?ids={{ it.id }}&title=0" target="_blank" rel="noopener">Label</a>
            </td>
          </tr>
          {% else %}
          <tr class="empty-row">
            <td colspan="6">
              <div class="empty-note">No items yet.</div>
            </td>
          </tr>
          <script>
            document.getElementById('manualAddBtn')?.addEventListener('click', () => {
              const sel = document.getElementById('manualAddCategory');
              const cat = sel?.value;
              const base = `{{ url_for('items_new') }}`;
              const url = cat ? `${base}?category_id=${encodeURIComponent(cat)}` : base;
              window.location.assign(url);
            });
          </script>
          
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>
{% endblock %}
