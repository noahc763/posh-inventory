{% extends "base.html" %}
{% block content %}

<section class="card">
  <div class="card-header" style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
    <h2 style="margin:0;">{{ 'Edit item' if item else 'Add item' }}</h2>
  </div>

  <div class="card-body">
    <form
      method="post"
      enctype="multipart/form-data"
      action="{% if item %}{{ url_for('items.edit_item', item_id=item.id) }}{% else %}{{ url_for('items.add_item') }}{% endif %}"
      class="form"
      style="display:grid;grid-template-columns:1fr 1fr;gap:14px;"
    >

      <!-- Left column -->
      <div class="field">
        <label>Title</label>
        <input name="title" required placeholder="Item title" value="{{ item.title if item else '' }}" />
      </div>

      <div class="field">
        <label>Barcode</label>
        <input name="barcode" placeholder="UPC/EAN or your code" value="{{ item.barcode if item else (request.args.get('barcode') or '') }}" />
      </div>

      <div class="field">
        <label>Category</label>
        <select name="category_id" class="input">
          <option value="">— None —</option>
          {% for c in categories %}
            <option value="{{ c.id }}" {% if item and item.category_id == c.id %}selected{% endif %}>{{ c.name }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="field">
        <label>Purchase source</label>
        <input name="purchase_source" placeholder="Where did you buy it?" value="{{ item.purchase_source if item else '' }}" />
      </div>

      <div class="field">
        <label>Purchase price</label>
        <input name="purchase_price" type="number" inputmode="decimal" step="0.01" min="0" value="{{ '%.2f'|format(item.purchase_price) if item and item.purchase_price is not none else '' }}" />
      </div>

      <div class="field">
        <label>Purchase date</label>
        <input name="purchase_date" type="date" value="{{ item.purchase_date.strftime('%Y-%m-%d') if item and item.purchase_date else '' }}" />
      </div>

      <div class="field">
        <label>List price</label>
        <input name="list_price" type="number" inputmode="decimal" step="0.01" min="0" value="{{ '%.2f'|format(item.list_price) if item and item.list_price is not none else '' }}" />
      </div>

      <div class="field">
        <label>Sold price</label>
        <input name="sold_price" type="number" inputmode="decimal" step="0.01" min="0" value="{{ '%.2f'|format(item.sold_price) if item and item.sold_price is not none else '' }}" />
      </div>

      <div class="field">
        <label>Sold date</label>
        <input name="sold_date" type="date" value="{{ item.sold_date.strftime('%Y-%m-%d') if item and item.sold_date else '' }}" />
      </div>

      <div class="field" style="grid-column:1/-1;">
        <label>Notes</label>
        <textarea name="notes" rows="4" placeholder="Optional details…">{{ item.notes if item else '' }}</textarea>
      </div>

      <div class="field" style="grid-column:1/-1;">
        <label>Photo</label>
        <input type="file" name="photo" accept="image/*" />
        {% if item and item.photo_path %}
          <div class="muted small" style="margin-top:6px;">Current: {{ item.photo_path }}</div>
        {% endif %}
      </div>

      <div style="grid-column:1/-1;display:flex;gap:10px;justify-content:flex-end;">
        <a class="btn outline" href="{{ url_for('item_detail', item_id=item.id) if item else url_for('dashboard') }}">Cancel</a>
        <button class="btn" type="submit">{{ 'Save changes' if item else 'Create item' }}</button>
      </div>
    </form>
  </div>
</section>

{% endblock %}
